<!DOCTYPE html>
<html>
  <head>
      <meta charset="UTF-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
      <title>간단한 지도 표시하기</title>
      <script src="./jquery-1.9.1.js"></script>
      <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=&submodules=drawing,geocoder&callback=initMap"></script>
      <script type="text/javascript">
          
          var home = N.LatLng(37.6289635, 126.8255385);
          var hwajung = N.LatLng(37.630413, 126.828216);
          var heangshin = N.LatLng(37.623446, 126.835039);
          
          // 1000 개의 마커 만들기 
          MARKER_COUNT = 1000;
          markers = [];
          
          var map = null;
          
          window.navermap_authFailure = function () {
              // 인증 실패 시 처리 코드 작성
              alert("인증실패");
          }    
          // 지도 초기화 
          function initMap() {

            var mapOptions = {
                center: home,
                zoom: 10
            };            
            // param1: 표시될 DOM id
            map = new N.Map('map',mapOptions);
            var marker = showCenterMarker();

            initMarkers();
            // showMarker(hwajung, '화정');
            // showMarker(heangshin, '행신');
            
            // bindClickEvent(marker);
            // bindKVO();
          }
          
          function initMarkers() {
            // N : 37.800000, W : 126.320000
            // S : 36.400000, E : 129.400000
            for (var i=0; i < MARKER_COUNT; i++) {
              let lat = rangeRandom(36, 37, 6);
              let lng = rangeRandom(126, 129, 6);
              
              let strlat = ""+lat;
              let strlng = ""+lng;
              
              let latLng = N.LatLng(lat, lng);
              let marker = drawMarker(latLng, strlat+","+ strlng);
              
              markers.push(marker);
            }
          }

          function rangeRandom(min, max, scale) {

            let result = Math.random() * (max - min) + min;
            return result.toFixed(scale);
          }
          
          // 기본 조작          
          function toCenter() {
            map.setCenter(home);
          }      
          function setZoomLevel() {
            const txtZoom = document.getElementById("txtZoom");
            let zoomLevel = parseInt(txtZoom.value);
            if (zoomLevel > 20) zoomLevel = 20;
            if (zoomLevel < 10) zoomLevel = 10;
            map.setZoom(zoomLevel);
          }  
          
          // 마커 표시 
          function showCenterMarker() {
            
            var markerOptions = {
                position: map.getCenter(),
                map: map,
                title: '내 위치'
            };

            return new N.Marker(markerOptions);
          }
          // marker 위치를 중심으로 지도 이동  
          function bindClickEvent(marker) {
            
            var mapElement = map.getElement();
            // map 과 click 이벤트 핸들러를 연결 
            var listener = N.Event.addDOMListener(mapElement, 'click', function() {
                map.setZoom(8);
                map.setCenter(marker.getPosition());
                // N.Event.removeDOMListener(listener);
            });
          } 
          
          function bindKVO() {
            
            var contentEl = $('<div class="iw_inner" style="width:350px;position:absolute;top:0;right:0;z-index:1000;background-color:#fff;border:solid 1px #333;">'
                + '<h3>Map States</h3>'
                + '<p style="font-size:14px;">zoom : <em class="zoom">'+ map.getZoom() +'</em></p>'
                + '<p style="font-size:14px;">center : <em class="center">'+ map.getCenter() +'</em></p>'
                + '<p style="font-size:14px;">bounds : <em class="bounds">'+ map.getBounds() +'</em></p>'
                + '</div>');

            var mapElement = map.getElement();
            contentEl.appendTo(mapElement);

            naver.maps.Event.addListener(map, 'zoom_changed', function(zoom) {
                contentEl.find('.zoom').text(zoom);
            });

            N.Event.addListener(map, 'bounds_changed', function(bounds) {
                contentEl.find('.center').text(map.getCenter());
                contentEl.find('.bounds').text(bounds);
            });
   
          }
          // 마커 표시
          function drawMarker(latLng, title) {
            
            var markerOptions = {
                position: latLng,
                map: map,
                title: title,
                icon: {
                  url: 'ship.png',
                  size: new naver.maps.Size(22, 35),
                  origin: new naver.maps.Point(0, 0),
                  anchor: new naver.maps.Point(11, 35)
                }
            };

            return new N.Marker(markerOptions);
          }
          
          /*************************************************
           *        지도 영역 안에 있는 마커만 표시 
           *************************************************/  
           /*            
           naver.maps.Event.addListener(map, 'zoom_changed', function() {
               updateMarkers(map, markers);
           });
            
           naver.maps.Event.addListener(map, 'dragend', function() {
               updateMarkers(map, markers);
           });
           */
           function updateMarkers(map, markers) {

               var mapBounds = map.getBounds();
               var marker, position;

               for (var i = 0; i < markers.length; i++) {

                   marker = markers[i];
                   position = marker.getPosition();

                   if (mapBounds.hasLatLng(position)) {
                       showMarker(map, marker);
                   } else {
                       hideMarker(map, marker);
                   }
               }
           }

           function showMarker(map, marker) {

               if (marker.setMap()) return;
               marker.setMap(map);
           }

           function hideMarker(map, marker) {

               if (!marker.setMap()) return;
               marker.setMap(null);
           }
      </script>
    </head>  
  <body>
    <div id="map" style="width:400px;height:400px;"></div>
    <div>
      <input type="button" value="중앙으로" onclick="toCenter();" />
      <input type="text" id="txtZoom" value="10" />
      <input type="button" value="zoom설정" onclick="setZoomLevel();" />
    </div>
    <!--div class="iw_inner" style="width:350px;position:absolute;top:0;right:0;z-index:1000;background-color:#fff;border:solid 1px #333;" -->
    <br/><br/><br/>
    
    <div style="width:350px;background-color:#fff;border:solid 1px #333;">  
      <h3>Map States</h3>
      <p style="font-size:14px;">zoom : <em class="zoom">'+ map.getZoom() +'</em></p>
      <p style="font-size:14px;">center : <em class="center">'+ map.getCenter() +'</em></p>
      <p style="font-size:14px;">bounds : <em class="bounds">'+ map.getBounds() +'</em></p>
    </div>
  </body>  
</html>